from dataclasses import dataclass
from typing import Optional
from pharma_company.exceptions import *

@dataclass
class Клиент:
    """Клиент компании: может совершать покупки и заключать контракты."""
    id: int
    имя: str
    тип: str  # 'физлицо' или 'юрлицо'
    надёжность: int
    карта: Optional["БанковскаяКарта"] = None

    def оплатить(self, сервис: "ПлатёжСервис", компания_карта: "БанковскаяКарта", сумма: float) -> bool:
        if not self.карта:
            raise НедостаточноСредств("У клиента нет карты.")
        return сервис.перевод(self.карта, компания_карта, сумма)

    def повысить_надёжность(self, баллы: int):
        self.надёжность = max(0, self.надёжность + баллы)


@dataclass
class Контракт:
    """Контракт на поставку препарата."""
    id: int
    клиент: Клиент
    компания: "ФармацевтическаяКомпания"
    препарат: "Препарат"
    сумма: float
    подписан: bool = False
    действует: bool = False

    def подписать(self):
        self.подписан = True
        self.действует = True

    def проверить_оплату(self, оплачено: bool):
        if not оплачено:
            raise ОшибкаОтчётности("Оплата по контракту не подтверждена.")


@dataclass
class Заказ:
    """Заказ клиента на препарат."""
    id: int
    клиент: Клиент
    препарат: "Препарат"
    количество: int
    статус: str = "создан"

    def подтвердить(self):
        self.статус = "подтверждён"

    def отменить(self):
        self.статус = "отменён"


@dataclass
class Продажа:
    """Продажа препарата в аптеке."""
    id: int
    аптека: "Аптека"
    препарат: "Препарат"
    количество: int
    сумма: float

    def провести(self):
        pass

    def возврат(self):
        pass
