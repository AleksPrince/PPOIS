from dataclasses import dataclass, field
from typing import List, Optional
from pharma_company.exceptions import *

@dataclass
class Сотрудник:
    """Сотрудник компании: базовые поля и квалификация."""
    id: int
    имя: str
    должность: str
    активен: bool = True
    квалификация: List[str] = field(default_factory=list)

    def деактивировать(self):
        self.активен = False

    def проверить_квалификацию(self, требуемая: str) -> bool:
        if требуемая not in self.квалификация:
            raise НекорректныеПраваДоступа(f"Нет квалификации: {требуемая}")
        return True


@dataclass
class МенеджерПродаж:
    """Менеджер продаж: управляет планами и бюджетами."""
    сотрудник: Сотрудник
    зона_ответственности: str
    текущий_препарат: Optional["Препарат"] = None
    активен: bool = True

    def назначить_препарат(self, препарат: "Препарат"):
        self.текущий_препарат = препарат

    def утвердить_бюджет(self, бюджет: "Бюджет"):
        if бюджет.запланировано > бюджет.лимит:
            raise НедостаточноСредств("Превышен лимит бюджета.")
        бюджет.утверждён = True


@dataclass
class Фармацевт:
    """Фармацевт: оформляет рецепты и контролирует качество."""
    сотрудник: Сотрудник
    рецепты: List["Рецепт"] = field(default_factory=list)
    активен: bool = True

    def оформить_рецепт(self, рецепт: "Рецепт"):
        if рецепт.недействителен:
            raise ОтсутствуетСертификатКачества("Рецепт недействителен.")
        self.рецепты.append(рецепт)

    def проверить_стандарт(self, стандарт: "СтандартКачества") -> bool:
        if not стандарт.актуален:
            raise ЗапретРегулятора("Стандарт неактуален.")
        return True


@dataclass
class Кладовщик:
    """Кладовщик: отвечает за склад и протокол хранения."""
    сотрудник: Сотрудник
    склад: "Склад"
    смена: str
    активен: bool = True

    def принять_поставку(self, партия: "Партия"):
        if not self.склад.протокол or not self.склад.протокол.актуален:
            raise НарушениеТемпературногоРежима("Протокол хранения неактуален.")
        self.склад.добавить_партию(партия)

    def провести_инвентаризацию(self) -> int:
        return sum(p.количество for p in self.склад.партии)
